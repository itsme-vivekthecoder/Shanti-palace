<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Complete Payment — Shanti Palace</title>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<section style="padding:40px; display:flex; justify-content:center;">
  <div style="width:420px; background:white; padding:24px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.08);">
    <h2 style="color:#c27802; text-align:center;">Complete Your Payment</h2>

    <div style="margin-top:16px;">
      <p><strong>Name:</strong> <span id="p_name"></span></p>
      <p><strong>Phone:</strong> <span id="p_phone"></span></p>
      <p><strong>Room:</strong> <span id="p_room"></span></p>
      <p><strong>Members:</strong> <span id="p_members"></span></p>
      <p><strong>Check-In:</strong> <span id="p_checkin"></span></p>
      <p><strong>Check-Out:</strong> <span id="p_checkout"></span></p>
      <p><strong>Total Days:</strong> <span id="p_days"></span></p>
      <p style="font-size:18px;"><strong>Amount: ₹</strong><span id="p_amount"></span></p>
    </div>

    <button id="payBtn" class="btn-submit" style="width:100%; margin-top:12px;">Pay Now</button>
    <p style="text-align:center; margin-top:12px; color:#666; font-size:14px;">After successful payment we will save your booking and send confirmation.</p>
  </div>
</section>

<script>

  const name = localStorage.getItem("fullName") || "";
  const email = localStorage.getItem("email") || "";
  const phone = localStorage.getItem("phone") || "";
  const checkIn = localStorage.getItem("checkIn") || "";
  const checkOut = localStorage.getItem("checkOut") || "";
  const members = localStorage.getItem("members") || "";
  const roomType = localStorage.getItem("roomType") || "";
  const totalDays = localStorage.getItem("totalDays") || "";
  const finalAmount = localStorage.getItem("finalAmount") || 0;

  document.getElementById("p_name").innerText = name;
  document.getElementById("p_phone").innerText = phone;
  document.getElementById("p_room").innerText = roomType;
  document.getElementById("p_members").innerText = members;
  document.getElementById("p_checkin").innerText = checkIn;
  document.getElementById("p_checkout").innerText = checkOut;
  document.getElementById("p_days").innerText = totalDays;
  document.getElementById("p_amount").innerText = finalAmount;


  // Start Razorpay
  document.getElementById("payBtn").addEventListener("click", function(){
    const amountPaise = Math.round(Number(finalAmount) * 100);

    var options = {
      "key": "rzp_live_RkeY8hnUYgxlKN",
      "amount": amountPaise,
      "currency": "INR",
      "name": "Shanti Palace Vrindavan",
      "description": "Room Booking Payment",
      "prefill": { "name": name, "email": email, "contact": phone },

      "handler": function (response){
        submitBookingAfterPayment(response.razorpay_payment_id);
      },

      "theme": { "color": "#c27802" }
    };

    var rzp = new Razorpay(options);
    rzp.open();
  });



  // ----------------------------------------
  //       SAVE, SEND WHATSAPP & REDIRECT
  // ----------------------------------------
  function submitBookingAfterPayment(paymentId) {

    const cleanPhone = phone.replace(/\D/g, "").replace(/^0+/, "");

    // ---------- GOOGLE FORM (Owner receives data) ----------
    const googleFormURL =
    "https://docs.google.com/forms/d/e/1FAIpQLSciTMHoPTqDOYNXGWZ-U01QO0cihDlAUwiwuu2HjZbXwTLucw/formResponse";

    const formData = new URLSearchParams({
      "entry.1181525787": name,
      "entry.1505113845": phone,
      "entry.26796576": email,
      "entry.133939998": roomType,
      "entry.8435932": checkIn,
      "entry.1082238197": checkOut,
      "entry.516627955": totalDays,
      "entry.1301069124": members,
      "entry.764039404": finalAmount,
      "entry.2021412614": paymentId
    });

    fetch(googleFormURL, {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: formData.toString()
    });



    // ---------- USER WHATSAPP (Instant confirmation) ----------
    const userMsg =
      `Hello ${name},%0A%0A` +
      `Your booking at SHANTI PALACE is CONFIRMED!%0A%0A` +
      `Room Type: ${roomType}%0A` +
      `Check-In: ${checkIn}%0A` +
      `Check-Out: ${checkOut}%0A` +
      `Members: ${members}%0A` +
      `Total Days: ${totalDays}%0A` +
      `Amount Paid: ₹${finalAmount}%0A` +
      `Payment ID: ${paymentId}%0A%0A` +
      `Thank you for choosing us!`;

    // Popup-safe redirect
    window.location.href = `https://wa.me/91${cleanPhone}?text=${userMsg}`;



    // ---------- OWNER WHATSAPP (After delay) ----------
    const OWNER_PHONE = "918630760100";

    const ownerMsg =
      `New Booking Received!%0A%0A` +
      `Name: ${name}%0A` +
      `Phone: ${phone}%0A` +
      `Email: ${email}%0A` +
      `Room: ${roomType}%0A` +
      `Check-In: ${checkIn}%0A` +
      `Check-Out: ${checkOut}%0A` +
      `Members: ${members}%0A` +
      `Total Days: ${totalDays}%0A` +
      `Amount: ₹${finalAmount}%0A` +
      `Payment ID: ${paymentId}`;

    setTimeout(() => {
      window.location.href = `https://wa.me/${OWNER_PHONE}?text=${ownerMsg}`;
    }, 2000);



    // ---------- SUCCESS PAGE (final redirect) ----------
    setTimeout(() => {
      window.location.href = "success.html";
    }, 4000);
  }

</script>
</body>
</html>
